!function(x,I){function n(t){var a,i=null,r=null,n=null,o=null,e=null,s=null,l=null;function c(){(l=x("#"+t+"_buttons").find("button[data-action]")).on("click",function(e){switch(e.preventDefault(),x(this).attr("data-action")){case"alignLeft":f("left");break;case"alignJustify":f("justify");break;case"alignCenter":f("center");break;case"alignRight":f("right");break;case"bold":h(i.hasFormat("b")?"removeBold":"bold");break;case"italic":h(i.hasFormat("i")?"removeItalic":"italic");break;case"underline":h(i.hasFormat("u")?"removeUnderline":"underline");break;case"makeOrderedList":h(i.hasFormat("ol")?"removeList":"makeOrderedList");break;case"makeUnorderedList":h(i.hasFormat("ul")?"removeList":"makeUnorderedList");break;case"code":h("toggleCode");break;case"makeLink":h(i.hasFormat("a")?"removeLink":"makeLink");break;case"insertImage":h("insertImage");break;case"undo":h("undo"),p(),u();break;case"redo":h("redo"),p(),u();break;case"link":i.makeLink(x("#linkURL")[0].value),x("#linkURL")[0].value="";break;case"image":x("#articleImage")[0].files.length&&(t=x("#articleImageName").val(),a.append("fileName",t),x.ajax({type:"POST",url:x("#frmArticleImage").attr("action"),data:a,params:{resourceId:x("input[name='resourceId']")},cache:!1,contentType:!1,processData:!1,success:function(e){e&&e.message&&(e.data=e.data.replaceAll("\\","/"),e=e.data,x("#imageURL").prop("value",e),i.insertImage(x("#imageURL")[0].value),x("#imageURL")[0].value="")},error:function(e){e.responseJSON&&e.responseJSON.message&&M.toast({html:e.responseJSON.message,classes:"toast-error"})}})),i.insertImage(x("#imageURL")[0].value),x("#imageURL")[0].value="",x("#articleImageName")[0].value="",x("#articleImage").val("");break;case"editorialImage":d();break;case"color":i.setTextColour(x("#txtColor")[0].value),x("#txtColor")[0].value="";break;case"font-size":i.setFontSize(x("#txtFontSize")[0].value),x("#txtFontSize")[0].value="";break;case"bg-color":i.setHighlightColour(x("#txtBgColor")[0].value),x("#txtBgColor")[0].value="";break;case"code-editor":!function(){var e=x("#editorText").val(),t=x("#editorOutput").val(),a=x("#canRunCode").prop("checked");x("#txtBgColor")[0].value="";var n=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=t.length,n=0;n<5;n++)e+=t.charAt(Math.floor(Math.random()*a));return e}(),i=x("#editorLang :selected").text(),n=(e.match(/\s*\n[\t\s]*/),"<div class='codeEditor' id='"+n+"'>");n+=" <div class='editorialCode'>"+I.ReplaceSpecialChars(e)+"</div> <pre class='output'>"+t+"</pre>",n+="  <span  type='text' class='language' style='width:40%;margin-right:5%' >"+i+"</span>",n+="  <span type='text' style='width:40%' class='canRunCode' name='canRunCode'>"+a+"</span>",b(n+="  </div>")}();break;case"clear":i.setHTML(""),k()}var t}),(l=x("#"+t+"_button").find("button[data-action]")).on("click",function(){"editorialImage"===x(this).attr("data-action")&&d()}),e=l.find("button[data-action=undo]"),s=l.find("button[data-action=redo]"),$addNewTopic.on("click",()=>function(){var e=x("#code").val(),t={name:w("name"),code:e.replace(/\s/g,"-").replace("---","-").toLowerCase(),description:I.ReplaceSpecialChars(x("#txtEditor_topic").html()),metaDescription:w("metaDescription")};window.PEP.showLoader();var a=x("form#addNewResourceForm").attr("action"),e=x("form#addNewResourceForm").attr("method");x.ajax({url:a,data:t,dataType:"json",method:e,headers:{"X-Requested-With":"XMLHttpRequest"},success:function(e){M.toast({html:e.message,classes:"green-text"}),window.PEP.hideLoader()},error:function(e){window.PEP.handleException(e)}})}())}function d(){var e;x("#editorialImage")[0].files.length&&(e=x("#editorialImageName").val(),a.append("fileName",e),x.ajax({type:"POST",url:x("#frmEditorialImage").attr("action"),data:a,params:{questionId:x("input[name='questionId']")},cache:!1,contentType:!1,processData:!1,success:function(e){e&&e.message&&(e.data=e.data.replaceAll("\\","/"),e=e.data,x("#imageURL").prop("value",e),i.insertImage(x("#imageURL")[0].value),x("#imageURL")[0].value="")},error:function(e){e.responseJSON&&e.responseJSON.message&&M.toast({html:e.responseJSON.message,classes:"toast-error"})}})),i.insertImage(x("#imageURL")[0].value),x("#imageURL")[0].value="",x("#editorialImageName")[0].value="",x("#editorialImage").val("")}function u(){0!==i._undoIndex?e.addClass("active").removeClass("inactive"):e.addClass("inactive").removeClass("active"),i._undoIndex+1<i._undoStackLength&&i._isInUndoState?s.addClass("active").removeClass("inactive"):s.addClass("inactive").removeClass("active")}function m(e){if(e&&e.fragment){for(var t=e.fragment.textContent,a=0;a<t.length;a++)if(255<t.charCodeAt(a))return void alert("This text contains unicode char "+t.charAt(a));x(e.fragment).text(x.trim(x(e.fragment).text()).replace(/\s+/g," "))}}function v(e){e&&e.preventDefault&&e.preventDefault();e=e.dataTransfer.getData("Text");this.insertPlainText(e,!0)}function f(e){i.setTextAlignment(e)}function h(e){i[e]()}function g(){return x.trim(r.text())}function p(){g()?o.addClass("hide"):o.removeClass("hide")}function k(){o.removeClass("hide")}function L(){o.addClass("hide")}function C(){var t=null,e=r.get(0);return e&&e.childNodes&&e.childNodes.length&&x.each(e.childNodes,function(){var e=x(this);x.trim(e.text())&&(t=e)}),t}function b(e){i.saveUndoState();var t=C();t?t.after(e):r.prepend(e),L(),u()}x("#frmArticleImage").change(function(e){e.preventDefault(),a=new FormData(this)}),x("#frmEditorialImage").change(function(e){e.preventDefault(),a=new FormData(this)}),this.Init=function(){n=x("#"+t),o=n.prev(".placeholder");var e=x.trim(n.next(".default-content").html());i=new Squire(n.get(0),{blockTag:"p"}),r=x(i.getRoot()),e?i.setHTML(e):k(),i.addEventListener("focus",L).addEventListener("blur",function(){g()||k(),u()}).addEventListener("willPaste",m).removeEventListener("drop").addEventListener("drop",v),c(),o.on("click",function(){i.focus()})},this.GetContent=function(){var e=i.getHTML();if(e){var s=x("<div />").html(e);return function(){var i,r,e=s.get(0);if(e){var t=(r=[],i=0,function e(t){if(t&&(r.push({node:t,index:i}),i++,t.childNodes&&t.childNodes.length))for(var a=0,n=t.childNodes.length;a<n;a++)e(t.childNodes[a])}(e),r);if(t&&t.length)for(var a=!1,n=t.length-1;-1<n;n--){var o=t[n].node,o=x(o);(a=!a&&x.trim(o.text())?!0:a)&&!o.is("br")||o.remove()}}}(),s.html()}return null},this.SetContent=function(e){i.setHTML(x.trim(e)),p()},this.AddHtml=function(e){b(x("<div>"+e+"</div>"))},this.AddParagraph=function(e){b(x("<p>"+e+"</p>"))},this.AddList=function(e){i.saveUndoState();var t,a,n=C();n?n.is("ul")?(t=x("<li>"+e+"</li>"),n.append(t)):(a=x("<ul><li>"+e+"</li></ul>"),n.after(a)):(a=x("<ul><li>"+e+"</li></ul>"),r.prepend(a)),L(),u()}}function w(e){var t=x("#"+e).val();if("name"==e){for(var t=t.toLowerCase().split(" "),a=0;a<t.length;a++)t[a]=t[a].charAt(0).toUpperCase()+t[a].slice(1);t=t.join(" ")}return t?I.ReplaceSpecialChars(t):""}$addNewTopic=x("#addNewTopic"),I.TxtEditor=new function(){var a={};this.Init=function(e,t){a[e]=new n(e),a[e].Init()},this.GetContent=function(e){return a[e].GetContent()},this.SetContent=function(e,t){a[e].SetContent(t)},this.AddParagraph=function(e,t){a[e].AddParagraph(t)},this.AddList=function(e,t){a[e].AddList(t)},this.AddHtml=function(e,t){a[e].AddHtml(t)}}}(window.jQuery,window.PEP);